<html>
    <script>
        var cbPopup;
        var lastTab;
        var swfList=[];
        function runBestSWF() {
            swfList.sort(function(a,b) { return b.width*b.height-a.width*a.height; });
            cbPopup(swfList);
        }

        function runSWF(i) {
            swfList[i].msg="runSwf";
            chrome.tabs.sendRequest(lastTab.id, swfList[i], function(response) {});
        }

        function findSWF(cb) {
            cbPopup=cb;
            chrome.tabs.getSelected(undefined,function(tab) {
                lastTab=tab;
                swfList=[];
                chrome.tabs.sendRequest(tab.id, {msg: "findSwf"}, function(response) {});
            });
        }

        var TID;
        chrome.extension.onRequest.addListener(
            function(request, sender, sendResponse) {
                if(TID!=undefined) clearTimeout(TID);
                TID=setTimeout(runBestSWF, 200);
                swfList.push(request);
            });
        
    </script>
</html>
